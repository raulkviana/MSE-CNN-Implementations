<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MSE-CNN Implementation: MSE-CNN Implementation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MSE-CNN Implementation<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Code database with the implementation of MSE-CNN, from the paper &#39;DeepQTMT: A Deep Learning Approach for Fast QTMT-based CU Partition of Intra-mode VVC&#39;</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MSE-CNN Implementation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_pages__doxygen_2mainpage"></a></p>
<div align="center"> <img src="../../msecnn_model.png" alt="" width="800" class="inline"/> </div><p> <br  />
 <br  />
</p>
<p>Code database with an implementation of MSE-CNN [1]. Besides the code, the dataset and coefficients obtained after training are provided.</p>
<ul>
<li>MSE-CNN Implementation<ul>
<li><a class="el" href="namespacedemo.html">Demo</a></li>
<li>Quickstart</li>
<li>1. Introduction</li>
<li>2. Theorectical Background<ul>
<li>2.1 Partitioning in VVC</li>
<li>2.2 MSE-CNN<ul>
<li>2.2.1 Architecture</li>
<li>2.2.2 Loss Function</li>
<li>2.2.3 Training</li>
<li>2.2.4 Implementation remarks</li>
</ul>
</li>
</ul>
</li>
<li>3. Dataset</li>
<li>4. Results<ul>
<li>4.1 F1-score, Recall and Precision with test data</li>
<li>4.2 Confusion matrices<ul>
<li>4.2.1 Stages 2 and 3</li>
<li>4.2.2 Stages 4 and 5</li>
<li>4.2.3 Stage 6</li>
</ul>
</li>
<li>4.3 Y-PSNR, Complexity Reduction and Bitrate with test data</li>
</ul>
</li>
<li>5. Relevant Folders and files<ul>
<li>5.1 Folders</li>
<li>5.2 Files in src folder</li>
</ul>
</li>
<li>6. Installation of dependencies<ul>
<li>Requirements</li>
<li>Package Distributions</li>
</ul>
</li>
<li>7. Contributions</li>
<li>8. License</li>
<li>9. TODO</li>
<li>10. References</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Demo</h1>
<p>Apply the MSE-CNN in your own pictures with its demo here: <a href="https://kevinmevin-demo-mse-cnn.hf.space">https://kevinmevin-demo-mse-cnn.hf.space</a></p>
<h1><a class="anchor" id="autotoc_md5"></a>
Quickstart</h1>
<div class="fragment"><div class="line">&gt;&gt;&gt; <span class="keyword">import</span> torch</div>
<div class="line">&gt;&gt;&gt; <span class="keyword">import</span> msecnn</div>
<div class="line">&gt;&gt;&gt; <span class="keyword">import</span> train_model_utils</div>
<div class="line">&gt;&gt;&gt;</div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Initialize parameters</span></div>
<div class="line">&gt;&gt;&gt; path_to_folder_with_model_params = <span class="stringliteral">&quot;model_coefficients/best_coefficients&quot;</span></div>
<div class="line">&gt;&gt;&gt; device = <span class="stringliteral">&quot;cuda:0&quot;</span></div>
<div class="line">&gt;&gt;&gt; qp = 32  <span class="comment"># Quantisation Parameter</span></div>
<div class="line">&gt;&gt;&gt; </div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Initialize Model</span></div>
<div class="line">&gt;&gt;&gt; stg1_2 = msecnn.MseCnnStg1(device=device, QP=qp).to(device)</div>
<div class="line">&gt;&gt;&gt; stg3 = msecnn.MseCnnStgX(device=device, QP=qp).to(device)</div>
<div class="line">&gt;&gt;&gt; stg4 = msecnn.MseCnnStgX(device=device, QP=qp).to(device)</div>
<div class="line">&gt;&gt;&gt; stg5 = msecnn.MseCnnStgX(device=device, QP=qp).to(device)</div>
<div class="line">&gt;&gt;&gt; stg6 = msecnn.MseCnnStgX(device=device, QP=qp).to(device)</div>
<div class="line">&gt;&gt;&gt; model = (stg1_2, stg3, stg4, stg5, stg6)</div>
<div class="line">&gt;&gt;&gt;</div>
<div class="line">&gt;&gt;&gt; model = train_model_utils.load_model_parameters_eval(model, path_to_folder_with_model_params, device)</div>
<div class="line">&gt;&gt;&gt;</div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Loss function</span></div>
<div class="line">&gt;&gt;&gt; loss_fn = msecnn.LossFunctionMSE()</div>
<div class="line">&gt;&gt;&gt; </div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Path to labels</span></div>
<div class="line">&gt;&gt;&gt; l_path_val = <span class="stringliteral">&quot;example_data/stg2&quot;</span></div>
<div class="line">&gt;&gt;&gt;</div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Random CTU and labels</span></div>
<div class="line">&gt;&gt;&gt; CTU = torch.rand(1, 1, 128, 128).to(device)</div>
<div class="line">&gt;&gt;&gt; CTU</div>
<div class="line">tensor([[[[0.9320, 0.6777, 0.4490,  ..., 0.0413, 0.6278, 0.5375],</div>
<div class="line">          [0.3544, 0.5620, 0.8339,  ..., 0.6420, 0.2527, 0.3104],</div>
<div class="line">          [0.0555, 0.4991, 0.9972,  ..., 0.3898, 0.1169, 0.1661],</div>
<div class="line">          ...,</div>
<div class="line">          [0.9452, 0.3566, 0.9825,  ..., 0.3941, 0.7534, 0.8656],</div>
<div class="line">          [0.3839, 0.8459, 0.4369,  ..., 0.9569, 0.2609, 0.6421],</div>
<div class="line">          [0.1734, 0.7182, 0.8074,  ..., 0.2122, 0.7573, 0.2492]]]])</div>
<div class="line">&gt;&gt;&gt; cu_pos = torch.tensor([[0, 0]]).to(device)</div>
<div class="line">&gt;&gt;&gt; cu_size = torch.tensor([[64, 64]]).to(device)  <span class="comment"># Size of the CU of the second stage</span></div>
<div class="line">&gt;&gt;&gt; split_label = torch.tensor([[1]]).to(device)</div>
<div class="line">&gt;&gt;&gt; RDs = torch.rand(1, 6).to(device) * 10_000</div>
<div class="line">&gt;&gt;&gt; RDs</div>
<div class="line">tensor([[1975.6646, 2206.7600, 1570.3577, 3570.9478, 6728.2612,  527.9994]])</div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Compute prediction for stages 1 and 2</span></div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Stage 1 and 2</span></div>
<div class="line">&gt;&gt;&gt; pred1_2, CUs, ap = model[0](CTU, cu_size, cu_pos)  <span class="comment"># Pass CU through network</span></div>
<div class="line">&gt;&gt;&gt; pred1_2</div>
<div class="line">tensor([[9.9982e-01, 1.8124e-04, 9.9010e-21, 5.9963e-29, 1.9118e-24, 1.0236e-25]],</div>
<div class="line">       grad_fn=&lt;SoftmaxBackward0&gt;)</div>
<div class="line">&gt;&gt;&gt; CUs.shape</div>
<div class="line">torch.Size([1, 16, 64, 64])</div>
<div class="line">&gt;&gt;&gt; </div>
<div class="line">&gt;&gt;&gt; <span class="comment"># Compute the loss</span></div>
<div class="line">&gt;&gt;&gt; loss, loss_CE, loss_RD = loss_fn(pred1_2, split_label, RDs)</div>
<div class="line">&gt;&gt; loss</div>
<div class="line">tensor(177.1340, grad_fn=&lt;AddBackward0&gt;)</div>
<div class="line">&gt;&gt; loss_CE</div>
<div class="line">tensor(174.3921, grad_fn=&lt;NegBackward0&gt;)</div>
<div class="line">&gt;&gt; loss_RD</div>
<div class="line">tensor(2.7419, grad_fn=&lt;MeanBackward1&gt;)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
1. Introduction</h1>
<p>The emergence of new technologies that provide creative audiovisual experiences, such as 360-degree films, virtual reality, augmented reality, 4K, 8K UHD, 16K, and also with the rise of video traffic on the web, shows the current demand for video data in the modern world. Because of this tension, Versatile Video Coding (VVC) was developed due to the the necessity for the introduction of new coding standards. Despite the advancements achieved with the introduction of this standard, its complexity has increased very much. The new partitioning technique is responsible for majority of the increase in encoding time. This extended duration is linked with the optimization of the Rate-Distortion cost (RD cost). Although VVC offers higher compression rates, the complexity of its encoding is high.</p>
<div align="center"> <img src="../../funny_memes_about_this_work/72rrr9.jpg" alt="" width="300" class="inline"/> </div><div align="center">Fig. 1: VVC Complexity</div><div align="center"> </div><p>In light of this, the Multi-Stage Exit Convolutional Neural Nework (MSE-CNN) was developed. This Deep Learning-based model is organised in a sequential structure with several stages. Each stage, which represents a different partition depth, encompasses a set of layers for extracting features from a Coding Tree Unit (CTU) and deciding how to partition it. Instead of using recursive approaches to determine the optimal way to fragment an image, this model allows VVC to estimate the most appropriate way of doing it. <b>This work presents a model of the MSE-CNN that employs training procedures distinct from the original implementation of this network, as well as the ground-thruth to train and validate the model and an interpretation of the work done by the MSE-CNN’s original creators</b>.</p>
<div align="center"> <img src="../../funny_memes_about_this_work/72roie.jpg" alt="" width="400" class="inline"/> </div><div align="center">Fig. 2: MSE-CNN benefits</div><div align="center"> </div><h1><a class="anchor" id="autotoc_md7"></a>
2. Theorectical Background</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
2.1 Partitioning in VVC</h2>
<p>The key objective of partitioning is to divide frames into pieces in a way that results in a reduction of the RD cost. To achieve a perfect balance of quality and bitrate, numerous image fragments combinations must be tested, which is computationally expensive. Due to the intensive nature of this process, a high compression rate can be attained. Partitioning contributes heavily to both the complexity and compression gains in VVC. H.266 (VVC), organize a video sequence in many frames that are divided into smaller pieces. First, pictures are split into coding tree units (CTUs), and then they are divided into coding units (CUs). For the luma channel, the largest CTU size in VVC is 128x128 and the smallest is 4x4. In VVC, a quad-tree (QT) is initially applied to the CTUs in the first level, and then a quad-tree with nested multi-type tree (QMTT) is applied recursively.</p>
<div align="center"> <img src="../../vvc_parti_real.png" alt="" class="inline"/> </div><div align="center">Fig. 3: Types of partitions in VVC</div><div align="center"> </div><p>This innovation makes it possible to split CUs in different rectangle forms. Splitting a CU into:</p>
<ul>
<li>three rectangles with a ratio of 1:2:1 results in a ternary tree (TT), with the center rectangle being half the size of the original CU; when applied horizontally it is called a horizontal ternary tree (HTT), and vertical ternary tree (VTT) when it is done vertically.</li>
<li>two rectangles results in a binary tree (BT)partition, a block with two symmetrical structures; like in the case of the TT, depending on the way the split is done, it can be called either a vertical binary tree (VBT) or a horizontal binary tree (HBT).</li>
</ul>
<p>The association of BT and TT is named a multi-type tree (MTT). The introduction of BT and TT partitions enables the creation of various new types of forms, with heights and widths that can be a combination between 128, 64, 32, 16, 8 and 4. The increased number of possible CUs boosts the ability of the codec to fragment an image more efficiently, allowing better predictions and higher compressing abilities. Although this standard now have these advantages, as a downside it takes longer to encode.</p>
<div align="center"> <img src="../../partitioning_image.png" alt="" class="inline"/> </div><div align="center">Fig. 4: Partitioning in VVC</div><div align="center"> </div><h2><a class="anchor" id="autotoc_md9"></a>
2.2 MSE-CNN</h2>
<p>Multi-Stage Exit Convolutional Neural Network (MSE-CNN) is a DL model that seeks to forecast CUs in a waterfall architecture (top-down manner), it integrates . This structure takes a CTU as input, extracts features from it, splits the CU into one of at most six possible partitions (Non-split, QT, HBT, VBT, HTT, and VTT), and then sends it to the next stage. This model has CTUs as inputs in the first stage, either in the chroma or luma channel, and feature maps in the subsequent stages. Furthermore, it generates feature maps and a split decision at each level. In the event that one of the models returns the split decision as Non-Split, the partitioning of the CU is ended immediately.</p>
<p><b>Note</b>: Details about how to load model coefficients can be found <a class="el" href="md_pages__doxygen_2modelcoefpage.html">here</a>.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
2.2.1 Architecture</h3>
<p>This model is composed by the following blocks:</p>
<ul>
<li>Initially, this model adds more channels to the input of this network to create more features from it; this is accomplished by utilising simple convolutional layers.</li>
</ul>
<div align="center"> <img src="../../over_con_block.drawio.png" alt="" class="inline"/> </div><div align="center">Fig. 5: Overlapping convolution layer</div><div align="center"> </div><ul>
<li>To extract more characteristics from the data, the information is then passed through a series of convolutional layers; these layers were named Conditional Convolution.</li>
</ul>
<div align="center"> <img src="../../resnet_mse.png" alt="" class="inline"/> </div><div align="center">Fig. 6: Conditional Convolution</div><div align="center"> </div><ul>
<li>At the end, a final layer is employed to determine the optimal manner of partitioning the CU. This layer is a blend of fully connected and convolutional layers.</li>
</ul>
<div align="center"> <img src="../../sub_networks.png" alt="" class="inline"/> </div><div align="center">Fig. 7: Sub-networks</div><div align="center"> </div><p><span style="text-decoration: underline">Note</span>: For more details regarding these layers check [1]</p>
<h3><a class="anchor" id="autotoc_md11"></a>
2.2.2 Loss Function</h3>
<p>The loss developed for the MSE-CNN is the result of two other functions, as defined in the following expression:</p>
<p>$$ L = L_{CE}+\beta L_{RD}$$</p>
<p>In the above equation, $\beta$ is a real number to adjust the influence of the $L_{RD}$ loss. The first member of this loss function is a modified Cross-Entrotopy loss, developed to solve imbalanced dataset issues:</p>
<p>$$L_{CEmod} = -\frac{1}{N}\sum_{n=1}^N \sum_{m\varepsilon Partitions}(\frac{1}{p_m})^\alpha y_{n, m}\log(\hat{y}_{n, m})$$</p>
<div align="center"> <sub> Eq. 1: In this equation "n" is the batch number, "m" is the corresponding partition (0 (Non-Split), 1 (QT), 2 (HBT), 3 (VBT), 4 (VTT), 5 (HTT)), "N" is the total number of batches and alpha is a parameter to configure the penalties for the less represented classes </sub> </div><p><br  />
 <br  />
</p>
<p>Concerning the second member of the MSE-CNN loss function, this constituent gives the network the ability to also make predictions based on the RD Cost.</p>
<p>$$L_{RD} = \frac{1}{N}\sum_{n=1}^N \sum_{m\varepsilon Partitions}\hat{y}_{n, m}\frac{r_{n, m}}{r_{n, min}}-1$$</p>
<p>In the above equation, the RD costs $r_{n, m}$ uses the same notation for "n" and "m" as the previous equation. Regarding $r_{n ,min}$, it is the minimal RD cost for the nth CU among all split modes and $$\frac{r_{n, m}}{r_{n, min}} - 1$$ is a normalised RD cost. As a relevant note, $r_{n, min}$ is equal to the RD cost of the best partition mode. Consequently, the result of</p>
<div align="center"> <img src="../../formula.png" alt="" class="inline"/> </div><p>ensures that CU's partitions with greater erroneously predicted probability values or greater RD cost values $r_{n, m}$ are more penalised. In $\frac{r_{n, m}}{r_{n, min}} - 1$, the ideal partition has a normalised RD cost of zero, but the other partitions do not. Therefore, the only way for the loss to equal zero is if the probability for all other modes also equals zero. Consequently, the learning algorithm must assign a greater probability to the optimal split mode while reducing the probabilities for the rest. <b>Experimentally it was verified that this function wasn't able to contribute to the training of the MSE-CNN, this contradicted the remarks made in [1]</b>.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
2.2.3 Training</h3>
<p>The strategy used to train the MSE-CNN was very similar to the one used in [1]. The first parts of the model to be trained were the first and second stages, in which 64x64 CUs were passed through the second depth. Afterwards, transfer learning was used to pass certain coefficients of the second stage to the third. Then, the third stage was trained with 32x32 CUs flowing through it. After this step, a similar process was done to the following stages. It is worth noting that, beginning with stage 4, various CUs forms are at the models' input. This means that these stages were fed different kinds of CUs. <br  />
</p>
<div align="center"> <img src="../../training_steps.png" alt="" width="300/" class="inline"/> </div><div align="center">Fig. 8: Training flow used</div><div align="center"> </div><p>At the end of training, 6 models were obtained one for each partitioning depth in the luma channel. Although models for the luma and chroma channels could be created for all the shapes of CUs that are possible, rather than just for each depth, only six were trained for the sake of assessing the model behaviour in a simpler and more understandable configuration.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
2.2.4 Implementation remarks</h3>
<p>Due to the deterministic nature of the first stage, where CTUs are always partitioned with a QT, it was implemented together with the second stage. If it was done separately, the training for the first two stages would have to be done at the same time. Consequently, two distinct optimisers would need to be employed, which could result in unpredictable training behaviour. <br  />
</p>
<div align="center"> <img src="../../subnet_min_32_1.drawio.png" alt="" width="300/" class="inline"/> <img src="../../subnet_min_32_2.drawio.png" alt="" width="300/" class="inline"/> </div><div align="center">Fig. 9: 32 minimum axis size sub-networks</div><div align="center"> </div><p>When implementing the sub-networks on code, those that were meant to cater for varying CU sizes were further implemented separately. For example, in the case of the sub-network utilised when the minimum width or height is 32, two variants of the first two layers were built. This was done because 64x32 and 32x32 CUs can flow across this block. Because of this, the first two layers were implemented separately from the entire block. Then, they were used in conjunction with the remaining layers based on the dimensions of the input CU. The same procedures were followed for the other types of sub-networks.</p>
<p>When the network was being trained, some of the RD costs from the input data had very high values. Consequently, the RD loss function value skyrocketed, resulting in extremely huge gradients during training. As a result, the maximum RD cost was hard coded at $10^{10}$. This amount is large enough to be more than the best partition's RD cost and small enough to address this issue.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
3. Dataset</h1>
<p>Please see this <a class="el" href="md_pages__doxygen_2dataset.html">page</a> to understand better the dataset and also access it. To see example data go to follow <a class="el" href="md_pages__doxygen_2exampledatapage.html">this</a>.</p>
<h1><a class="anchor" id="autotoc_md15"></a>
4. Results</h1>
<p>Since it was verified that the Rate-Distortion Loss. $L_{RD}$, could contribute for better results, the metrics presented here were obtained with a model trained only with the modified cross-entropy loss.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
4.1 F1-score, Recall and Precision with test data</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Stage   </th><th class="markdownTableHeadNone">F1-Score   </th><th class="markdownTableHeadNone">Recall   </th><th class="markdownTableHeadNone">Precision    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stage 2   </td><td class="markdownTableBodyNone">0.9111   </td><td class="markdownTableBodyNone">0.9111   </td><td class="markdownTableBodyNone">0.9112    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Stage 3   </td><td class="markdownTableBodyNone">0.5624   </td><td class="markdownTableBodyNone">0.5767   </td><td class="markdownTableBodyNone">0.5770    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stage 4   </td><td class="markdownTableBodyNone">0.4406   </td><td class="markdownTableBodyNone">0.4581   </td><td class="markdownTableBodyNone">0.4432    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Stage 5   </td><td class="markdownTableBodyNone">0.5143   </td><td class="markdownTableBodyNone">0.5231   </td><td class="markdownTableBodyNone">0.5184    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stage 6   </td><td class="markdownTableBodyNone">0.7282   </td><td class="markdownTableBodyNone">0.7411   </td><td class="markdownTableBodyNone">0.7311   </td></tr>
</table>
<p>Results with weighted average for F1-score, recall and precision.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
4.2 Confusion matrices</h2>
<h3><a class="anchor" id="autotoc_md18"></a>
4.2.1 Stages 2 and 3</h3>
<div align="center"> <img src="../../conf_mat_val_stg2.png" alt="" width="300" class="inline"/> <img src="../../conf_mat_val_v2_stg3.png" alt="" width="300" class="inline"/> </div><div align="center">Fig. 10: Confusion matrix results with the testing data in stages 2 and 3</div><div align="center"> </div><h3><a class="anchor" id="autotoc_md19"></a>
4.2.2 Stages 4 and 5</h3>
<div align="center"> <img src="../../conf_mat_val_stg4.png" alt="" width="300" class="inline"/> <img src="../../conf_mat_val_stg5.png" alt="" width="300" class="inline"/> </div><div align="center">Fig. 11: Confusion matrix results with the testing data in stages 4 and 5</div><div align="center"> </div><h3><a class="anchor" id="autotoc_md20"></a>
4.2.3 Stage 6</h3>
<div align="center"> <img src="../../conf_mat_val_stg6.png" alt="" width="300" class="inline"/> </div><div align="center">Fig. 12: Confusion matrix results with the testing data in stage 6</div><div align="center"> </div><h2><a class="anchor" id="autotoc_md21"></a>
4.3 Y-PSNR, Complexity Reduction and Bitrate with test data</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Metric   </th><th class="markdownTableHeadNone">VTM-7.0   </th><th class="markdownTableHeadNone">VTM-7.0+Model   </th><th class="markdownTableHeadNone">Gain    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Bitrate   </td><td class="markdownTableBodyNone">3810.192 kbps   </td><td class="markdownTableBodyNone">4069.392 kbps   </td><td class="markdownTableBodyNone">6.80%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Y-PSNR   </td><td class="markdownTableBodyNone">35.7927 dB   </td><td class="markdownTableBodyNone">35.5591 dB   </td><td class="markdownTableBodyNone">-0.65%    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Complexity   </td><td class="markdownTableBodyNone">1792.88 s   </td><td class="markdownTableBodyNone">1048.95 s   </td><td class="markdownTableBodyNone">-41.49%   </td></tr>
</table>
<p><b>These results were obtained with the "medium" configuration for the multi-thresholding method.</b></p>
<h1><a class="anchor" id="autotoc_md22"></a>
5. Relevant Folders and files</h1>
<h2><a class="anchor" id="autotoc_md23"></a>
5.1 Folders</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Folder   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="/dataset">dataset</a>   </td><td class="markdownTableBodyNone">This folder contains all of the dataset and all of the data that was processed in order to obtain it    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="/example_data">example_data</a>   </td><td class="markdownTableBodyNone">Here you can find some example data that it is used for the scripts in usefull_scripts folder    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="/model_coefficients">model_coefficients</a>   </td><td class="markdownTableBodyNone">The last coefficient obtained during training, as well as the best one in terms of the best F1-score obtained in testing data    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="/src">src</a>   </td><td class="markdownTableBodyNone">Source code with the implementation of the MSE-CNN and also useful code and examples   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md24"></a>
5.2 Files in src folder</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Files   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="constants_8py.html">constants.py</a>   </td><td class="markdownTableBodyNone">Constant values used in other python files    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="custom__dataset_8py.html">custom_dataset.py</a>   </td><td class="markdownTableBodyNone">Dataset class to handle the files with the ground-thruth information, as well as other usefull classes to work together with the aforementioned class    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="dataset__utils_8py.html">dataset_utils.py</a>   </td><td class="markdownTableBodyNone">Functions to manipulate and process the data, also contains functions to interact with YUV files    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="msecnn_8py.html">msecnn.py</a>   </td><td class="markdownTableBodyNone">MSE-CNN and Loss Function classes implementation    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="train__model__utils_8py.html">train_model_utils.py</a>   </td><td class="markdownTableBodyNone">Usefull functions to be used during training or evaluation of the artificial neural network    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="utils_8py.html">utils.py</a>   </td><td class="markdownTableBodyNone">Other functions that are usefull not directly to the model but for the code implementation itself   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md25"></a>
6. Installation of dependencies</h1>
<p>In order to explore this project, it is needed to first install of the libraries used in it.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Requirements</h2>
<p>For this please follow the below steps:</p><ol type="1">
<li>Create a virtual environment to do install the libraries; follow this <a href="https://www.geeksforgeeks.org/creating-python-virtual-environment-windows-linux/">link</a> in case you don't know how to do it; you possibly need to install <a href="https://www.makeuseof.com/tag/install-pip-for-python/">pip</a>, if you don't have it installed</li>
<li>Run the following command: <div class="fragment"><div class="line">pip install -r requirements.txt</div>
</div><!-- fragment --> This will install all of the libraries references in the requirements.txt file.</li>
</ol>
<ol type="1">
<li>When you have finished using the package or working on your project, you can deactivate the virtual environment: <div class="fragment"><div class="line">deactivate</div>
</div><!-- fragment --> This command exits the virtual environment and returns you to your normal command prompt.</li>
</ol>
<ol type="1">
<li>Enjoy! :)</li>
</ol>
<h2><a class="anchor" id="autotoc_md27"></a>
Package Distributions</h2>
<ol type="1">
<li>Locate the <code>dist</code> folder in your project's root directory. This folder contains the package distributions, including the source distribution (<code>*.tar.gz</code> file) and the wheel distribution (<code>*.whl</code> file).</li>
<li>Install the package using one of the following methods:<ul>
<li>Install the source distribution: <div class="fragment"><div class="line">pip install dist/msecnn_raulkviana-1.0.tar.gz</div>
</div><!-- fragment --></li>
<li>Install the wheel distribution: <div class="fragment"><div class="line">pip install dist/msecnn_raulkviana-1.0.whl</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Once the package is installed, you can import and use its functionalities in your Python code.</li>
</ol>
<h1><a class="anchor" id="autotoc_md28"></a>
7. Contributions</h1>
<p>Feel free to contact me through this <a href="raulviana@ua.pt">email</a> or create either a issue or pull request to contribute to this project ^^.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
8. License</h1>
<p>This project license is under the [MIT License](LICENSE).</p>
<h1><a class="anchor" id="autotoc_md30"></a>
9. TODO</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Task   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Status (d - doing, w - waiting, f- finished)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Implement code to test functions   </td><td class="markdownTableBodyNone">Use a library, such as Pytest, to test some functions from the many modules developed   </td><td class="markdownTableBodyNone">w   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md31"></a>
10. References</h1>
<p>[1] T. Li, M. Xu, R. Tang, Y. Chen, and Q. Xing, <a href="https://arxiv.org/abs/2006.13125">“DeepQTMT: A Deep Learning Approach for Fast QTMT-Based CU Partition of Intra-Mode VVC,”</a> IEEE Transactions on Image Processing, vol. 30, pp. 5377–5390, 2021, doi: 10.1109/tip.2021.3083447. [2] R. K. Viana, “Deep learning architecture for fast intra-mode CUs partitioning in VVC,” Universidade de Aveiro, Nov. 2022.</p>
<div align="center"> <img src="../../funny_memes_about_this_work/72rukf.gif" alt="" width="450" class="inline"/> </div><div align="center">:)</div><div align="center"> </div> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
